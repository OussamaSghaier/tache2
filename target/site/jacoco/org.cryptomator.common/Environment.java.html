<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Environment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Cryptomator Desktop App</a> &gt; <a href="index.source.html" class="el_package">org.cryptomator.common</a> &gt; <span class="el_source">Environment.java</span></div><h1>Environment.java</h1><pre class="source lang-java linenums">package org.cryptomator.common;

import com.google.common.base.Splitter;
import com.google.common.base.Strings;
import org.jetbrains.annotations.VisibleForTesting;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Optional;
import java.util.Spliterator;
import java.util.Spliterators;
import java.util.function.Predicate;
import java.util.stream.Stream;
import java.util.stream.StreamSupport;

public class Environment {

<span class="fc" id="L21">	private static final Logger LOG = LoggerFactory.getLogger(Environment.class);</span>
	private static final int DEFAULT_MIN_PW_LENGTH = 8;
	private static final String SETTINGS_PATH_PROP_NAME = &quot;cryptomator.settingsPath&quot;;
	private static final String IPC_SOCKET_PATH_PROP_NAME = &quot;cryptomator.ipcSocketPath&quot;;
	private static final String KEYCHAIN_PATHS_PROP_NAME = &quot;cryptomator.integrationsWin.keychainPaths&quot;;
	private static final String P12_PATH_PROP_NAME = &quot;cryptomator.p12Path&quot;;
	private static final String LOG_DIR_PROP_NAME = &quot;cryptomator.logDir&quot;;
	private static final String LOOPBACK_ALIAS_PROP_NAME = &quot;cryptomator.loopbackAlias&quot;;
	private static final String MOUNTPOINT_DIR_PROP_NAME = &quot;cryptomator.mountPointsDir&quot;;
	private static final String MIN_PW_LENGTH_PROP_NAME = &quot;cryptomator.minPwLength&quot;;
	private static final String APP_VERSION_PROP_NAME = &quot;cryptomator.appVersion&quot;;
	private static final String BUILD_NUMBER_PROP_NAME = &quot;cryptomator.buildNumber&quot;;
	private static final String PLUGIN_DIR_PROP_NAME = &quot;cryptomator.pluginDir&quot;;
	private static final String TRAY_ICON_PROP_NAME = &quot;cryptomator.showTrayIcon&quot;;
	private static final String DISABLE_UPDATE_CHECK_PROP_NAME = &quot;cryptomator.disableUpdateCheck&quot;;

	private Environment() {}

	public void log() {
<span class="nc" id="L40">		LOG.info(&quot;user.home: {}&quot;, System.getProperty(&quot;user.home&quot;));</span>
<span class="nc" id="L41">		LOG.info(&quot;java.library.path: {}&quot;, System.getProperty(&quot;java.library.path&quot;));</span>
<span class="nc" id="L42">		LOG.info(&quot;user.language: {}&quot;, System.getProperty(&quot;user.language&quot;));</span>
<span class="nc" id="L43">		LOG.info(&quot;user.region: {}&quot;, System.getProperty(&quot;user.region&quot;));</span>
<span class="nc" id="L44">		LOG.info(&quot;logback.configurationFile: {}&quot;, System.getProperty(&quot;logback.configurationFile&quot;));</span>
<span class="nc" id="L45">		logCryptomatorSystemProperty(SETTINGS_PATH_PROP_NAME);</span>
<span class="nc" id="L46">		logCryptomatorSystemProperty(IPC_SOCKET_PATH_PROP_NAME);</span>
<span class="nc" id="L47">		logCryptomatorSystemProperty(KEYCHAIN_PATHS_PROP_NAME);</span>
<span class="nc" id="L48">		logCryptomatorSystemProperty(P12_PATH_PROP_NAME);</span>
<span class="nc" id="L49">		logCryptomatorSystemProperty(LOG_DIR_PROP_NAME);</span>
<span class="nc" id="L50">		logCryptomatorSystemProperty(LOOPBACK_ALIAS_PROP_NAME);</span>
<span class="nc" id="L51">		logCryptomatorSystemProperty(MOUNTPOINT_DIR_PROP_NAME);</span>
<span class="nc" id="L52">		logCryptomatorSystemProperty(MIN_PW_LENGTH_PROP_NAME);</span>
<span class="nc" id="L53">		logCryptomatorSystemProperty(APP_VERSION_PROP_NAME);</span>
<span class="nc" id="L54">		logCryptomatorSystemProperty(BUILD_NUMBER_PROP_NAME);</span>
<span class="nc" id="L55">		logCryptomatorSystemProperty(PLUGIN_DIR_PROP_NAME);</span>
<span class="nc" id="L56">		logCryptomatorSystemProperty(TRAY_ICON_PROP_NAME);</span>
<span class="nc" id="L57">		logCryptomatorSystemProperty(DISABLE_UPDATE_CHECK_PROP_NAME);</span>
<span class="nc" id="L58">	}</span>

	public static Environment getInstance() {
<span class="nc" id="L61">		final class Holder {</span>

<span class="fc" id="L63">			private static final Environment INSTANCE = new Environment();</span>
		}
<span class="fc" id="L65">		return Holder.INSTANCE;</span>
	}

	private void logCryptomatorSystemProperty(String propertyName) {
<span class="nc" id="L69">		LOG.info(&quot;{}: {}&quot;, propertyName, System.getProperty(propertyName));</span>
<span class="nc" id="L70">	}</span>

	public boolean useCustomLogbackConfig() {
<span class="pc" id="L73">		return getPath(&quot;logback.configurationFile&quot;).map(Files::exists).orElse(false);</span>
	}

	public Stream&lt;Path&gt; getSettingsPath() {
<span class="fc" id="L77">		return getPaths(SETTINGS_PATH_PROP_NAME);</span>
	}

	public Stream&lt;Path&gt; getIpcSocketPath() {
<span class="fc" id="L81">		return getPaths(IPC_SOCKET_PATH_PROP_NAME);</span>
	}

	public Stream&lt;Path&gt; getKeychainPath() {
<span class="fc" id="L85">		return getPaths(KEYCHAIN_PATHS_PROP_NAME);</span>
	}

	public Stream&lt;Path&gt; getP12Path() {
<span class="fc" id="L89">		return getPaths(P12_PATH_PROP_NAME);</span>
	}

	public Optional&lt;Path&gt; getLogDir() {
<span class="fc" id="L93">		return getPath(LOG_DIR_PROP_NAME);</span>
	}

	public Optional&lt;String&gt; getLoopbackAlias() {
<span class="nc" id="L97">		return Optional.ofNullable(System.getProperty(LOOPBACK_ALIAS_PROP_NAME));</span>
	}

	public Optional&lt;Path&gt; getMountPointsDir() {
<span class="nc" id="L101">		return getPath(MOUNTPOINT_DIR_PROP_NAME);</span>
	}

	public int getMinPwLength() {
<span class="nc" id="L105">		return Integer.getInteger(MIN_PW_LENGTH_PROP_NAME, DEFAULT_MIN_PW_LENGTH);</span>
	}

	/**
	 * Returns the app version defined in the {@value APP_VERSION_PROP_NAME} property or returns &quot;SNAPSHOT&quot;.
	 *
	 * @return App version or &quot;SNAPSHOT&quot;, if undefined
	 */
	public String getAppVersion() {
<span class="nc" id="L114">		return System.getProperty(APP_VERSION_PROP_NAME, &quot;SNAPSHOT&quot;);</span>
	}

	public Optional&lt;String&gt; getBuildNumber() {
<span class="nc" id="L118">		return Optional.ofNullable(System.getProperty(BUILD_NUMBER_PROP_NAME));</span>
	}

	public Optional&lt;Path&gt; getPluginDir() {
<span class="nc" id="L122">		return getPath(PLUGIN_DIR_PROP_NAME);</span>
	}

	public boolean showTrayIcon() {
<span class="nc" id="L126">		return Boolean.getBoolean(TRAY_ICON_PROP_NAME);</span>
	}

	public boolean disableUpdateCheck() {
<span class="nc" id="L130">		return Boolean.getBoolean(DISABLE_UPDATE_CHECK_PROP_NAME);</span>
	}

	private Optional&lt;Path&gt; getPath(String propertyName) {
<span class="fc" id="L134">		String value = System.getProperty(propertyName);</span>
<span class="fc" id="L135">		return Optional.ofNullable(value).map(Paths::get);</span>
	}

	@VisibleForTesting
	Stream&lt;Path&gt; getPaths(String propertyName) {
<span class="fc" id="L140">		Stream&lt;String&gt; rawSettingsPaths = getRawList(propertyName, System.getProperty(&quot;path.separator&quot;).charAt(0));</span>
<span class="fc" id="L141">		return rawSettingsPaths.filter(Predicate.not(Strings::isNullOrEmpty)).map(Path::of);</span>
	}

	private Stream&lt;String&gt; getRawList(String propertyName, char separator) {
<span class="fc" id="L145">		String value = System.getProperty(propertyName);</span>
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">		if (value == null) {</span>
<span class="nc" id="L147">			return Stream.empty();</span>
		} else {
<span class="fc" id="L149">			Iterable&lt;String&gt; iter = Splitter.on(separator).split(value);</span>
<span class="fc" id="L150">			Spliterator&lt;String&gt; spliterator = Spliterators.spliteratorUnknownSize(iter.iterator(), Spliterator.ORDERED | Spliterator.IMMUTABLE);</span>
<span class="fc" id="L151">			return StreamSupport.stream(spliterator, false);</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>