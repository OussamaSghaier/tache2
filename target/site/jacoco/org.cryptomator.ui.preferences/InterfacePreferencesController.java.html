<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InterfacePreferencesController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Cryptomator Desktop App</a> &gt; <a href="index.source.html" class="el_package">org.cryptomator.ui.preferences</a> &gt; <span class="el_source">InterfacePreferencesController.java</span></div><h1>InterfacePreferencesController.java</h1><pre class="source lang-java linenums">package org.cryptomator.ui.preferences;

import org.cryptomator.common.LicenseHolder;
import org.cryptomator.common.settings.Settings;
import org.cryptomator.common.settings.UiTheme;
import org.cryptomator.launcher.SupportedLanguages;
import org.cryptomator.ui.common.FxController;
import org.cryptomator.ui.traymenu.TrayMenuComponent;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.inject.Inject;
import javafx.beans.property.ObjectProperty;
import javafx.beans.value.ObservableValue;
import javafx.fxml.FXML;
import javafx.geometry.NodeOrientation;
import javafx.scene.control.CheckBox;
import javafx.scene.control.ChoiceBox;
import javafx.scene.control.RadioButton;
import javafx.scene.control.Toggle;
import javafx.scene.control.ToggleGroup;
import javafx.util.StringConverter;
import java.util.Locale;
import java.util.ResourceBundle;

@PreferencesScoped
public class InterfacePreferencesController implements FxController {

<span class="nc" id="L29">	private static final Logger LOG = LoggerFactory.getLogger(InterfacePreferencesController.class);</span>

	private final Settings settings;
	private final boolean trayMenuInitialized;
	private final boolean trayMenuSupported;
	private final ObjectProperty&lt;SelectedPreferencesTab&gt; selectedTabProperty;
	private final LicenseHolder licenseHolder;
	private final ResourceBundle resourceBundle;
	private final SupportedLanguages supportedLanguages;
	public ChoiceBox&lt;UiTheme&gt; themeChoiceBox;
	public CheckBox showMinimizeButtonCheckbox;
	public CheckBox showTrayIconCheckbox;
	public ChoiceBox&lt;String&gt; preferredLanguageChoiceBox;
	public ToggleGroup nodeOrientation;
	public RadioButton nodeOrientationLtr;
	public RadioButton nodeOrientationRtl;

	@Inject
<span class="nc" id="L47">	InterfacePreferencesController(Settings settings, SupportedLanguages supportedLanguages, TrayMenuComponent trayMenu, ObjectProperty&lt;SelectedPreferencesTab&gt; selectedTabProperty, LicenseHolder licenseHolder, ResourceBundle resourceBundle) {</span>
<span class="nc" id="L48">		this.settings = settings;</span>
<span class="nc" id="L49">		this.trayMenuInitialized = trayMenu.isInitialized();</span>
<span class="nc" id="L50">		this.trayMenuSupported = trayMenu.isSupported();</span>
<span class="nc" id="L51">		this.selectedTabProperty = selectedTabProperty;</span>
<span class="nc" id="L52">		this.licenseHolder = licenseHolder;</span>
<span class="nc" id="L53">		this.resourceBundle = resourceBundle;</span>
<span class="nc" id="L54">		this.supportedLanguages = supportedLanguages;</span>
<span class="nc" id="L55">	}</span>

	@FXML
	public void initialize() {
<span class="nc" id="L59">		themeChoiceBox.getItems().addAll(UiTheme.applicableValues());</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">		if (!themeChoiceBox.getItems().contains(settings.theme.get())) {</span>
<span class="nc" id="L61">			settings.theme.set(UiTheme.LIGHT);</span>
		}
<span class="nc" id="L63">		themeChoiceBox.valueProperty().bindBidirectional(settings.theme);</span>
<span class="nc" id="L64">		themeChoiceBox.setConverter(new UiThemeConverter(resourceBundle));</span>

<span class="nc" id="L66">		showMinimizeButtonCheckbox.selectedProperty().bindBidirectional(settings.showMinimizeButton);</span>

<span class="nc" id="L68">		showTrayIconCheckbox.selectedProperty().bindBidirectional(settings.showTrayIcon);</span>

<span class="nc" id="L70">		preferredLanguageChoiceBox.getItems().addAll(supportedLanguages.getLanguageTags());</span>
<span class="nc" id="L71">		preferredLanguageChoiceBox.valueProperty().bindBidirectional(settings.language);</span>
<span class="nc" id="L72">		preferredLanguageChoiceBox.setConverter(new LanguageTagConverter(resourceBundle));</span>

<span class="nc bnc" id="L74" title="All 2 branches missed.">		nodeOrientationLtr.setSelected(settings.userInterfaceOrientation.get() == NodeOrientation.LEFT_TO_RIGHT);</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">		nodeOrientationRtl.setSelected(settings.userInterfaceOrientation.get() == NodeOrientation.RIGHT_TO_LEFT);</span>
<span class="nc" id="L76">		nodeOrientation.selectedToggleProperty().addListener(this::toggleNodeOrientation);</span>
<span class="nc" id="L77">	}</span>


	public boolean isTrayMenuInitialized() {
<span class="nc" id="L81">		return trayMenuInitialized;</span>
	}

	public boolean isTrayMenuSupported() {
<span class="nc" id="L85">		return trayMenuSupported;</span>
	}

	private void toggleNodeOrientation(@SuppressWarnings(&quot;unused&quot;) ObservableValue&lt;? extends Toggle&gt; observable, @SuppressWarnings(&quot;unused&quot;) Toggle oldValue, Toggle newValue) {
<span class="nc bnc" id="L89" title="All 2 branches missed.">		if (nodeOrientationLtr.equals(newValue)) {</span>
<span class="nc" id="L90">			settings.userInterfaceOrientation.set(NodeOrientation.LEFT_TO_RIGHT);</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">		} else if (nodeOrientationRtl.equals(newValue)) {</span>
<span class="nc" id="L92">			settings.userInterfaceOrientation.set(NodeOrientation.RIGHT_TO_LEFT);</span>
		} else {
<span class="nc" id="L94">			LOG.warn(&quot;Unexpected toggle option {}&quot;, newValue);</span>
		}
<span class="nc" id="L96">	}</span>

	public LicenseHolder getLicenseHolder() {
<span class="nc" id="L99">		return licenseHolder;</span>
	}


	@FXML
	public void showContributeTab() {
<span class="nc" id="L105">		selectedTabProperty.set(SelectedPreferencesTab.CONTRIBUTE);</span>
<span class="nc" id="L106">	}</span>

	/* Helper classes */

	private static class UiThemeConverter extends StringConverter&lt;UiTheme&gt; {

		private final ResourceBundle resourceBundle;

<span class="nc" id="L114">		UiThemeConverter(ResourceBundle resourceBundle) {</span>
<span class="nc" id="L115">			this.resourceBundle = resourceBundle;</span>
<span class="nc" id="L116">		}</span>

		@Override
		public String toString(UiTheme impl) {
<span class="nc" id="L120">			return resourceBundle.getString(impl.getDisplayName());</span>
		}

		@Override
		public UiTheme fromString(String string) {
<span class="nc" id="L125">			throw new UnsupportedOperationException();</span>
		}

	}

	private static class LanguageTagConverter extends StringConverter&lt;String&gt; {

		private final ResourceBundle resourceBundle;

<span class="nc" id="L134">		LanguageTagConverter(ResourceBundle resourceBundle) {</span>
<span class="nc" id="L135">			this.resourceBundle = resourceBundle;</span>
<span class="nc" id="L136">		}</span>

		@Override
		public String toString(String tag) {
<span class="nc bnc" id="L140" title="All 2 branches missed.">			if (tag == null) {</span>
<span class="nc" id="L141">				return resourceBundle.getString(&quot;preferences.interface.language.auto&quot;);</span>
			} else {
<span class="nc" id="L143">				var locale = Locale.forLanguageTag(tag);</span>
<span class="nc" id="L144">				return locale.getDisplayName();</span>
			}
		}

		@Override
		public String fromString(String displayLanguage) {
<span class="nc" id="L150">			throw new UnsupportedOperationException();</span>
		}
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>