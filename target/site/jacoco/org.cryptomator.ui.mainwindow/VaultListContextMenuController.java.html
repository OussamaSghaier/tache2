<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VaultListContextMenuController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Cryptomator Desktop App</a> &gt; <a href="index.source.html" class="el_package">org.cryptomator.ui.mainwindow</a> &gt; <span class="el_source">VaultListContextMenuController.java</span></div><h1>VaultListContextMenuController.java</h1><pre class="source lang-java linenums">package org.cryptomator.ui.mainwindow;

import org.cryptomator.common.keychain.KeychainManager;
import org.cryptomator.common.vaults.Vault;
import org.cryptomator.common.vaults.VaultState;
import org.cryptomator.ui.common.FxController;
import org.cryptomator.ui.common.VaultService;
import org.cryptomator.ui.fxapp.FxApplicationWindows;
import org.cryptomator.ui.removevault.RemoveVaultComponent;
import org.cryptomator.ui.vaultoptions.SelectedVaultOptionsTab;
import org.cryptomator.ui.vaultoptions.VaultOptionsComponent;

import javax.inject.Inject;
import javafx.beans.property.ObjectProperty;
import javafx.beans.property.ReadOnlyObjectProperty;
import javafx.beans.value.ObservableValue;
import javafx.fxml.FXML;
import javafx.stage.Stage;
import java.util.EnumSet;
import java.util.Objects;

import static org.cryptomator.common.vaults.VaultState.Value.ERROR;
import static org.cryptomator.common.vaults.VaultState.Value.LOCKED;
import static org.cryptomator.common.vaults.VaultState.Value.MISSING;
import static org.cryptomator.common.vaults.VaultState.Value.NEEDS_MIGRATION;
import static org.cryptomator.common.vaults.VaultState.Value.UNLOCKED;

@MainWindowScoped
public class VaultListContextMenuController implements FxController {

	private final ReadOnlyObjectProperty&lt;Vault&gt; selectedVault;
	private final Stage mainWindow;
	private final FxApplicationWindows appWindows;
	private final VaultService vaultService;
	private final KeychainManager keychain;
	private final RemoveVaultComponent.Builder removeVault;
	private final VaultOptionsComponent.Factory vaultOptionsWindow;
	private final ObservableValue&lt;VaultState.Value&gt; selectedVaultState;
	private final ObservableValue&lt;Boolean&gt; selectedVaultPassphraseStored;
	private final ObservableValue&lt;Boolean&gt; selectedVaultRemovable;
	private final ObservableValue&lt;Boolean&gt; selectedVaultUnlockable;
	private final ObservableValue&lt;Boolean&gt; selectedVaultLockable;

	@Inject
<span class="nc" id="L45">	VaultListContextMenuController(ObjectProperty&lt;Vault&gt; selectedVault, @MainWindow Stage mainWindow, FxApplicationWindows appWindows, VaultService vaultService, KeychainManager keychain, RemoveVaultComponent.Builder removeVault, VaultOptionsComponent.Factory vaultOptionsWindow) {</span>
<span class="nc" id="L46">		this.selectedVault = selectedVault;</span>
<span class="nc" id="L47">		this.mainWindow = mainWindow;</span>
<span class="nc" id="L48">		this.appWindows = appWindows;</span>
<span class="nc" id="L49">		this.vaultService = vaultService;</span>
<span class="nc" id="L50">		this.keychain = keychain;</span>
<span class="nc" id="L51">		this.removeVault = removeVault;</span>
<span class="nc" id="L52">		this.vaultOptionsWindow = vaultOptionsWindow;</span>

<span class="nc" id="L54">		this.selectedVaultState = selectedVault.flatMap(Vault::stateProperty).orElse(null);</span>
<span class="nc" id="L55">		this.selectedVaultPassphraseStored = selectedVault.map(this::isPasswordStored).orElse(false);</span>
<span class="nc" id="L56">		this.selectedVaultRemovable = selectedVaultState.map(EnumSet.of(LOCKED, MISSING, ERROR, NEEDS_MIGRATION)::contains).orElse(false);</span>
<span class="nc" id="L57">		this.selectedVaultUnlockable = selectedVaultState.map(LOCKED::equals).orElse(false);</span>
<span class="nc" id="L58">		this.selectedVaultLockable = selectedVaultState.map(UNLOCKED::equals).orElse(false);</span>
<span class="nc" id="L59">	}</span>

	private boolean isPasswordStored(Vault vault) {
<span class="nc" id="L62">		return keychain.getPassphraseStoredProperty(vault.getId()).get();</span>
	}

	@FXML
	public void didClickRemoveVault() {
<span class="nc" id="L67">		var vault = Objects.requireNonNull(selectedVault.get());</span>
<span class="nc" id="L68">		removeVault.vault(vault).build().showRemoveVault();</span>
<span class="nc" id="L69">	}</span>

	@FXML
	public void didClickShowVaultOptions() {
<span class="nc" id="L73">		var vault = Objects.requireNonNull(selectedVault.get());</span>
<span class="nc" id="L74">		vaultOptionsWindow.create(vault).showVaultOptionsWindow(SelectedVaultOptionsTab.ANY);</span>
<span class="nc" id="L75">	}</span>

	@FXML
	public void didClickUnlockVault() {
<span class="nc" id="L79">		var vault = Objects.requireNonNull(selectedVault.get());</span>
<span class="nc" id="L80">		appWindows.startUnlockWorkflow(vault, mainWindow);</span>
<span class="nc" id="L81">	}</span>

	@FXML
	public void didClickLockVault() {
<span class="nc" id="L85">		var vault = Objects.requireNonNull(selectedVault.get());</span>
<span class="nc" id="L86">		appWindows.startLockWorkflow(vault, mainWindow);</span>
<span class="nc" id="L87">	}</span>

	@FXML
	public void didClickRevealVault() {
<span class="nc" id="L91">		var vault = Objects.requireNonNull(selectedVault.get());</span>
<span class="nc" id="L92">		vaultService.reveal(vault);</span>
<span class="nc" id="L93">	}</span>

	// Getter and Setter

	public ObservableValue&lt;Boolean&gt; selectedVaultUnlockableProperty() {
<span class="nc" id="L98">		return selectedVaultUnlockable;</span>
	}

	public boolean isSelectedVaultUnlockable() {
<span class="nc" id="L102">		return selectedVaultUnlockable.getValue();</span>
	}

	public ObservableValue&lt;Boolean&gt; selectedVaultLockableProperty() {
<span class="nc" id="L106">		return selectedVaultLockable;</span>
	}

	public boolean isSelectedVaultLockable() {
<span class="nc" id="L110">		return selectedVaultLockable.getValue();</span>
	}

	public ObservableValue&lt;Boolean&gt; selectedVaultRemovableProperty() {
<span class="nc" id="L114">		return selectedVaultRemovable;</span>
	}

	public boolean isSelectedVaultRemovable() {
<span class="nc" id="L118">		return selectedVaultRemovable.getValue();</span>
	}

	public ObservableValue&lt;Boolean&gt; selectedVaultPassphraseStoredProperty() {
<span class="nc" id="L122">		return selectedVaultPassphraseStored;</span>
	}

	public boolean isSelectedVaultPassphraseStored() {
<span class="nc" id="L126">		return selectedVaultPassphraseStored.getValue();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>